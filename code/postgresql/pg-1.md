## 用户及权限管理

**关键字**

用户、角色、权限

pg数据库的权限系统



### 用户和角色

pg数据库使用`角色`的概念来管理数据库访问权限。

角色是一系列相关权限的集合。

为了方便管理，通常会把一系列相关的权限赋给一个角色。

如果哪个用户需要这些权限，就把角色赋给用户。

由于用户也拥有一系列的相关权限，为了简化管理，在pg数据库中，角色和用户没有区别，一个用户也是一个角色。

可以把一个用户的权限赋给另外一个用户。



用户和角色在数据库实例中是全局的。

在同一个实例中的不同数据库中，用户都是相同的。



初始化数据库时，有一个预定义的超级用户。

这个用户的名称与初始化数据库的操作系统用户同名。

如果数据库是建在系统用户`postgres`（通常数据库是安装在这个用户下）下的，那么数据库的超级用户名也叫`postgres`。

通常使用超级用户创建出更多的普通用户或者其它超级用户。



### 创建用户和角色

```sql
CREATE ROLE name [ [WITH] option [...] ]
CREATE USER name [ [WITH] option [...] ]
```

有个细微的区别：

`create user`默认创建的用户有`LOGIN`权限，而通过`create role`创建出来的用户没有`LOGIN`权限外，其它没有区别。



option的内容：

```sql
SUPERUSER | NOSUPERUSER
CREATEDB | NOCREATEDB
...
```

### 权限管理

每个数据库的逻辑结构对象（包括数据库本身），都有一个所有者。

任何数据库对象都是属于某个用户的。

无需把对象的权限赋给所有者。所有者默认拥有所有权限。

出于安全的考虑，可以选择废弃一些所有者的权限。

删除以及任意修改对象的权限都不能赋给别的用户，它是所有者固有的权限，不能赋予或者撤销。

所有者隐式拥有把操作对象的权限赋给其它用户的权利。



用户的权限分2类：

1、创建用户时就指定的权限

2、由`GRANT`和`REVOKE`命令来管理的权限



### 总结

pg中的权限是按照以下几个层次来管理的：

1、首先管理赋在用户特殊属性上的权限，比如超级用户的权限、创建数据库的权限、创建用户的权限、LOGIN权限等。

2、然后是在数据库中创建模式的权限。

3、接着是在模式中创建数据库对象的权限，比如创建表、索引等。

4、之后是查询表、向表中插入数据、更新表、删除表的权限。

5、最后是操作表中某些字段的权限。





